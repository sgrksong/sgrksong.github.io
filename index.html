<!-- プレーヤー UI を画面下部に追加 -->
<div id="musicPlayer" class="fixed bottom-0 left-0 w-full bg-white border-t shadow z-50 px-4 py-2 flex items-center justify-between">
  <div class="flex items-center gap-4">
    <button id="prevBtn" class="text-gray-700 hover:text-blue-600">⏮️</button>
    <button id="playBtn" class="text-gray-700 hover:text-blue-600">▶️</button>
    <button id="nextBtn" class="text-gray-700 hover:text-blue-600">⏭️</button>
  </div>
  <div class="flex items-center gap-3">
    <label class="flex items-center gap-1">
      <input type="checkbox" id="shuffleToggle" class="accent-blue-500">
      <span class="text-sm text-gray-600">ランダム</span>
    </label>
    <label class="flex items-center gap-1">
      <input type="checkbox" id="repeatToggle" class="accent-blue-500">
      <span class="text-sm text-gray-600">リピート</span>
    </label>
  </div>
</div>

<script>
let currentIndex = -1;
let currentVideo = null;
let shuffledList = [];

function loadVideoByIndex(index) {
  const videos = document.querySelectorAll('#videoList > div');
  if (index < 0 || index >= videos.length) return;
  videos[index].querySelector('a').click();
  currentIndex = index;
}

document.getElementById('playBtn').addEventListener('click', () => {
  if (currentIndex === -1 && allVideos.length > 0) {
    loadVideoByIndex(0);
  } else {
    document.querySelector('iframe')?.contentWindow?.postMessage('playVideo', '*');
  }
});

document.getElementById('nextBtn').addEventListener('click', () => {
  const isShuffle = document.getElementById('shuffleToggle').checked;
  const videos = document.querySelectorAll('#videoList > div');
  if (isShuffle) {
    let next;
    do {
      next = Math.floor(Math.random() * videos.length);
    } while (next === currentIndex);
    loadVideoByIndex(next);
  } else {
    loadVideoByIndex((currentIndex + 1) % videos.length);
  }
});

document.getElementById('prevBtn').addEventListener('click', () => {
  const videos = document.querySelectorAll('#videoList > div');
  if (currentIndex > 0) {
    loadVideoByIndex(currentIndex - 1);
  } else {
    loadVideoByIndex(videos.length - 1);
  }
});
</script>
