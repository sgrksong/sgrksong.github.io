<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>にじさんじ所属 司賀りこ 歌まとめ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.4s ease-out both;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

/* リスト項目のスタイル */
#videoList div {
  background-color: #e0f7fa;
  border-radius: 8px;
  padding: 10px;
  margin-bottom: 5px;
  display: flex;
  justify-content: space-between;  /* 曲名とアーティスト名を左側、詳細情報を右側 */
  align-items: center;  /* 垂直方向のセンタリングを解除して上に揃える */
  width: 100%;  /* 親要素の幅に合わせて広がる */
  box-sizing: border-box;
}

/* 曲名とアーティスト名のスタイル */
#videoList div > div {
  display: flex;
  flex-direction: column;  /* 縦に並べる */
  justify-content: flex-start;
  align-items: flex-start;
  flex-grow: 0;  /* 要素が広がりすぎないように調整 */
  width: 70%;  /* 曲名とアーティスト名の領域が親要素の70%を占める */
}

/* 詳細情報のスタイル */
#videoList div > div:last-child {
  width: 30%;  /* 詳細情報は親要素の30%を占める */
  margin-left: 20px;  /* 詳細情報と曲名/アーティストの間隔を広げる */
}

#videoList a:hover {
  text-decoration: underline;  /* ホバー時に下線を追加 */
}

    /* ヘッダーを固定 */
header {
  position: sticky;
  top: 0;
  z-index: 10;
  background-color: white; /* 背景色を設定して、下のコンテンツが見えないように */
}

/* フィルターボタンを固定 */
section {
  position: sticky;
  top: 60px; /* ヘッダーの高さ分、フィルター部分がヘッダーの下に配置されるように */
  z-index: 9;  /* ヘッダーより下に配置 */
  background-color: white;
  padding-top: 5px;
}

      /* 固定プレイヤー用のCSS */
  #fixedPlayer {
    display: none; /* 最初は非表示 */
  }

/* 再生中の曲名表示部分 */
#nowPlaying {
  background-color: #e0f7fa;  /* 再生中の曲名に薄い青色背景 */
  color: #00796b;
  text-align: center;
  padding: 10px;
}

/* リストアイテムの強調表示 */
#videoList .playing {
  background-color: #e0f7fa;  /* 再生中の項目に背景色を追加 */
}

  </style>
</head>
<body class="bg-white text-gray-800">
  <header class="border-b sticky top-0 z-10 bg-white/90 backdrop-blur px-4 py-3 shadow-sm">
    <h1 class="text-center text-xl sm:text-2xl font-semibold text-gray-900 tracking-tight">🎤 にじさんじ所属 司賀りこ 歌まとめ</h1>
  </header>

  <section class="max-w-4xl mx-auto mt-6 px-4">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3">
      <select id="categoryFilter" class="rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">カテゴリ</option>
      </select>
      <select id="dateFilter" class="rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">公開日</option>
      </select>
      <select id="typeFilter" class="rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">動画種別</option>
      </select>
      <select id="roleFilter" class="rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">担当区分</option>
      </select>
      <input id="searchInput" type="text" placeholder="曲名・アーティスト" class="col-span-1 sm:col-span-2 rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200" />
      <select id="sortOrder" class="rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="desc">新しい順</option>
        <option value="asc">古い順</option>
      </select>
      <button id="resetFilters" class="bg-blue-100 hover:bg-blue-200 text-blue-900 font-medium text-sm px-4 py-2 rounded-md transition-all duration-300">リセット</button>
          <!-- ランダム再生ボタン -->
    <button id="randomPlayButton" class="bg-green-100 hover:bg-green-200 text-green-900 font-medium text-sm px-4 py-2 rounded-md transition-all duration-300 mt-4 w-full sm:w-auto">
      ランダム再生
    </button>
    </div>
  </section>

  <main id="videoList" class="max-w-4xl mx-auto px-4 py-8 divide-y divide-gray-200"></main>

  <!-- 再生中の曲名表示部分 -->
<div id="nowPlaying" class="fixed bottom-0 left-0 w-full bg-blue-100 text-blue-900 py-2 text-center font-medium z-30">
  <span id="nowPlayingTitle">再生中の曲名</span>
</div>

  <!-- 固定プレイヤー -->
<div id="fixedPlayer" class="fixed bottom-0 left-0 w-full bg-white border-t shadow-lg z-20">
  <div class="max-w-4xl mx-auto p-4">
    <div class="bg-black rounded-xl overflow-hidden shadow-lg">
      <iframe id="playerIframe" class="w-full aspect-video" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
  </div>
</div>

  <template id="videoPlayerTemplate">
    <div class="video-player-container w-full mt-4 fade-in">
      <div class="bg-black rounded-xl overflow-hidden shadow-lg">
        <iframe class="w-full aspect-video" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
    </div>
  </template>

  <script>
    const sheetJsonUrl = 'https://opensheet.elk.sh/1sZGH3TGYdC5UShrIEFEe2T8-axXEFet6qsxbqCoHX5o/%E3%82%B7%E3%83%BC%E3%83%881';
    let allVideos = [];

    window.addEventListener('DOMContentLoaded', () => {
      fetch(sheetJsonUrl)
        .then(response => response.json())
        .then(data => {
          allVideos = data;
          populateFilters(data);
          applyFilters();
        });

       const randomPlayButton = document.getElementById('randomPlayButton');

  // ランダム再生ボタンのクリックイベント
  randomPlayButton.addEventListener('click', () => {
    const randomVideo = allVideos[Math.floor(Math.random() * allVideos.length)]; // ランダムに動画を選択
    loadVideo(randomVideo, null); // ランダムに選ばれた動画を再生プレイヤーで再生
  });

      const categoryFilter = document.getElementById('categoryFilter');
      const dateFilter = document.getElementById('dateFilter');
      const typeFilter = document.getElementById('typeFilter');
      const roleFilter = document.getElementById('roleFilter');
      const searchInput = document.getElementById('searchInput');
      const sortOrder = document.getElementById('sortOrder');
      const resetButton = document.getElementById('resetFilters');
      const videoList = document.getElementById('videoList');
      const videoPlayerTemplate = document.getElementById('videoPlayerTemplate');

      function populateFilters(videos) {
        const sets = {
          category: new Set(),
          date: new Set(),
          type: new Set(),
          role: new Set()
        };

        videos.forEach(v => {
          sets.category.add(v["カテゴリ"]);
          sets.date.add(v["公開日"]);
          sets.type.add(v["動画種別"]);
          sets.role.add(v["担当区分"]);
        });

        addOptions(categoryFilter, [...sets.category].sort());
        addOptions(dateFilter, [...sets.date].sort());
        addOptions(typeFilter, [...sets.type].sort());
        addOptions(roleFilter, [...sets.role].sort());

        [categoryFilter, dateFilter, typeFilter, roleFilter, searchInput, sortOrder].forEach(el => {
          el.addEventListener('change', applyFilters);
          el.addEventListener('input', applyFilters);
        });

        resetButton.addEventListener('click', () => {
          categoryFilter.value = "";
          dateFilter.value = "";
          typeFilter.value = "";
          roleFilter.value = "";
          searchInput.value = "";
          sortOrder.value = "desc";
          applyFilters();
        });
      }

      function addOptions(select, values) {
        values.forEach(v => {
          if (!v) return;
          const option = document.createElement('option');
          option.value = v;
          option.textContent = v;
          select.appendChild(option);
        });
      }

      function applyFilters() {
        let filtered = allVideos.filter(video => {
          return (!categoryFilter.value || video["カテゴリ"] === categoryFilter.value) &&
                 (!dateFilter.value || video["公開日"] === dateFilter.value) &&
                 (!typeFilter.value || video["動画種別"] === typeFilter.value) &&
                 (!roleFilter.value || video["担当区分"] === roleFilter.value) &&
                 (!searchInput.value ||
                  video["title"].toLowerCase().includes(searchInput.value.toLowerCase()) ||
                  video["artist"].toLowerCase().includes(searchInput.value.toLowerCase()));
        });

        filtered.sort((a, b) => {
          const dateA = new Date(a["公開日"]);
          const dateB = new Date(b["公開日"]);
          return sortOrder.value === "asc" ? dateA - dateB : dateB - dateA;
        });

        renderVideoList(filtered);
      }

function renderVideoList(videos) {
  videoList.innerHTML = ''; // 既存のリストをリセット

  videos.forEach(video => {
    // リスト項目に枠線を追加
    const item = document.createElement('div');
    item.className = 'flex justify-between items-center gap-4 p-1 mb-1 bg-blue-100 rounded-lg shadow-md';  // 枠線はitemにだけ適用
    item.style.border = '2px solid #00796b';  // itemにだけ枠線を設定

    const info = document.createElement('div');
    info.className = 'flex flex-1 justify-between items-center';  // 横並びに配置

    const title = document.createElement('a');
    title.href = "#";
    title.className = 'text-xl font-semibold text-blue-800';  // 曲名
    title.textContent = video["title"];
    title.onclick = e => {
      e.preventDefault();
      loadVideo(video, item);  // 動画クリック時に再生
    };

    const artist = document.createElement('div');
    artist.className = 'text-sm text-gray-600';  // アーティスト名（少し小さめ）
    artist.textContent = video["artist"];

    // 詳細情報部分（meta）には枠線をつけない
    const meta = document.createElement('div');
    meta.className = 'text-sm text-gray-600';  // 詳細情報のフォント
    meta.innerHTML = `${video["カテゴリ"]} / ${video["公開日"]} / ${video["動画種別"]} / ${video["担当区分"]}`;

    info.appendChild(title);  // 曲名を追加
    info.appendChild(artist); // アーティスト名を追加
    item.appendChild(info);
    item.appendChild(meta);   // 詳細情報（右側に配置される）
  
              // 現在再生中の曲を強調表示
    const nowPlayingTitle = document.getElementById('nowPlayingTitle').textContent;
    if (`${video["title"]} - ${video["artist"]}` === nowPlayingTitle) {
      item.style.backgroundColor = '#e0f7fa'; // 再生中の曲に色を付ける
    } else {
      item.style.backgroundColor = ''; // 他の曲はリセット
    }

          videoList.appendChild(item);
        });
      }

function loadVideo(video, container) {
  const start = parseInt(video["start"] || '0');
  let videoId = video["videoId"];
  const platform = video["platform"];
  let embedUrl = "";

  if (!videoId) return alert("videoId が指定されていません");

  if (platform.toLowerCase().includes("youtube")) {
    const match = videoId.match(/(?:v=|\/|youtu\.be\/)?([0-9A-Za-z_-]{11})/);
    if (match) videoId = match[1];
    embedUrl = `https://www.youtube.com/embed/${videoId}?start=${start}&autoplay=1`;
  } else if (platform.toLowerCase() === "tiktok") {
    const match = videoId.match(/video\/(\d+)/);
    const tiktokId = match ? match[1] : videoId;
    embedUrl = `https://www.tiktok.com/embed/v2/${tiktokId}`;
  }

  // 固定プレイヤーに動画を設定
  const fixedPlayer = document.getElementById('fixedPlayer');
  const iframe = document.getElementById('playerIframe');
  iframe.src = embedUrl;
  fixedPlayer.style.display = 'block'; // プレイヤーを表示

   // 再生中の曲名を更新
  const nowPlayingTitle = document.getElementById('nowPlayingTitle');
  nowPlayingTitle.textContent = video["title"] + " - " + video["artist"];

  // 古い埋め込みプレイヤーを削除（固定プレイヤーを使うので他のプレイヤーは削除）
  document.querySelectorAll('.video-player-container').forEach(el => el.remove());
}

    });
  </script>
</body>
</html>
